# DragonEngine — Project Manifest

## Назначение

DragonEngine — модульный 2D-движок с визуальным редактором, ориентированный на:

* чёткое разделение ответственности между модулями
* расширяемую архитектуру (без монолита)
* читаемый и обучающий код (явные комментарии, параметры помечены как изменяемые)

Этот файл является **источником архитектурной истины** между чатами и версиями.

---

## Структура проекта

```
DragonEngine/
│
├─ engine_main.py            # Точка входа в движок
│
├─ engine/                   # ЯДРО (логика, без UI)
│  ├─ config_engine.py       # Глобальные настройки движка и редакторов
│  ├─ project_manager.py     # Реестр проектов, last_project, open/create
│  ├─ projects_index.json    # Реестр всех известных проектов
│  ├─ last_project.json      # Последний открытый проект
│  └─ __init__.py
│
├─ editor/                   # РЕДАКТОРЫ (UI, pygame)
│  ├─ editor_app.py          # Менеджер проектов (UI)
│  ├─ scene_editor.py        # Редактор сцены
│  └─ __init__.py
│
├─ res/                      # Ресурсы редактора (шрифты и т.п.)
│
├─ start_DragonEngine.bat    # Запуск движка под Windows
├─ .gitignore
└─ PROJECT_MANIFEST.md       # Этот файл
```

---

## Архитектурные инварианты (НЕ НАРУШАТЬ)

### Общие правила

* ❗ Архитектура **не упрощается** и **не откатывается**
* ❗ Любые правки делаются **на основе актуальных файлов из репозитория**
* ❗ Ничего не удаляется без явного согласования

### Зависимости

* `engine/` **НЕ знает** про `editor/`
* `editor/` **может использовать** `engine/`
* `project_manager.py` **не содержит UI**
* `editor_app.py` **не содержит логики работы со сценами**
* `scene_editor.py` **не знает** про реестр проектов

### Ответственность

* `engine_main.py` — только запуск и маршрутизация
* `project_manager.py` — единственный источник правды о проектах
* `config_engine.py` — все настраиваемые параметры UI и движка

---

## Форматы данных

### project.json

```json
{
  "name": "ИмяПроекта",
  "engine_version": "0.1",
  "start_scene": "scenes/main.scene.json"
}
```

### *.scene.json

```json
{
  "name": "MainScene",
  "entities": []
}
```

---

## Текущая точка развития

** Выполнен рефакторинг менеджера проектов:

  * логика работы с проектами (реестр, последний проект, открытие проекта) вынесена в `engine/project_manager.py`;
  * `project_manager.py` является единственным источником истины о проектах;
  * `editor/editor_app.py` содержит только UI и пользовательские действия.
* Пользовательский интерфейс менеджера проектов сохранён **без изменений** (UI 1:1).
* Добавлен адаптер `run_editor()` для обратной совместимости с существующей точкой входа (`engine_main.py`).
* Контракт `project_manager` стабилизирован под текущий интерфейс редактора (`list_all_projects`, `open_last_project`, `open_project_by_path`).


## Правила работы с репозиторием (ChatGPT)

* Источник истины: **ветка `main`**
* Перед любой правкой:

  1. Сначала читаются файлы из репозитория
  2. Затем учитывается контекст чата
* Из кода **ничего не выкидывается** без явного указания
* Правки предлагаются:

  * либо как `git diff`
  * либо как полный файл для замены

---

## Переход в новый чат

Перед началом нового чата пользователь указывает:

```
Продолжаем DragonEngine.
Источник истины — https://github.com/Gebzil96/DragonEngine (main).
PROJECT_MANIFEST.md актуален.
Текущая задача: ...
```

Если есть незакоммиченные изменения:

* они либо пушатся в репозиторий
* либо прикладывается `git diff` и явно указывается, что это не в `main`

